#!/bin/bash
# Metasploit Framework RC File
# Source this file to enable Metasploit commands in your shell (similar to Python virtualenv)
#
# Usage:
#   source msfrc
#
# This provides a "virtualenv-like" feel by making Metasploit commands
# available in your regular shell without needing to enter msfconsole.

# Determine the MSF installation directory
if [ -n "$BASH_SOURCE" ]; then
    export MSF_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
elif [ -n "$ZSH_VERSION" ]; then
    export MSF_ROOT="$(cd "$(dirname "$0")" && pwd)"
else
    # Fallback - try to determine from current directory
    export MSF_ROOT="$(pwd)"
fi

# Add MSF bin directory to PATH (if not already there)
if [[ ":$PATH:" != *":$MSF_ROOT:"* ]]; then
    export PATH="$MSF_ROOT:$PATH"
fi

# Set MSF environment variables
export MSF_DATABASE_CONFIG="$MSF_ROOT/config/database.yml"
export MSF_MODULE_PATHS="$MSF_ROOT/modules"
export MSF_PLUGIN_PATH="$MSF_ROOT/plugins"
export MSF_DATA_ROOT="$MSF_ROOT/data"

# Python-specific environment
export PYTHONPATH="$MSF_ROOT:$MSF_ROOT/lib:${PYTHONPATH:-}"

# Create convenient aliases for Metasploit tools
alias msfconsole="$MSF_ROOT/msfconsole"
alias msfvenom="$MSF_ROOT/msfvenom"
alias msfd="$MSF_ROOT/msfd"
alias msfrpc="$MSF_ROOT/msfrpc"
alias msfrpcd="$MSF_ROOT/msfrpcd"
alias msfdb="$MSF_ROOT/msfdb"

# Python framework shortcuts
alias msfpy="python3 -m metasploit"
alias msf-python="python3"

# Show activation message
echo ""
echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║     Metasploit Framework - Python-Native Edition             ║"
echo "╚═══════════════════════════════════════════════════════════════╝"
echo ""
echo "✓ Metasploit environment activated!"
echo ""
echo "Available commands:"
echo "  msfconsole    - Launch Metasploit console (classic Ruby experience)"
echo "  msfvenom      - Payload generation tool"
echo "  msfd          - Metasploit daemon"
echo "  msfdb         - Database management"
echo "  msfrpc        - RPC client"
echo ""
echo "Python-native alternatives:"
echo "  python3 modules/exploits/path/to/exploit.py --help"
echo "  python3 -m metasploit.console"
echo ""
echo "Transpiler tools:"
echo "  python3 transpilers/ruby2py/converter.py <ruby_file>"
echo "  python3 transpilers/py2ruby/transpiler.py <python_file>"
echo ""
echo "Documentation: $MSF_ROOT/docs/"
echo "MSF_ROOT: $MSF_ROOT"
echo ""
echo "To deactivate, use: deactivate-msf"
echo ""

# Create deactivation function
deactivate-msf() {
    # Remove MSF_ROOT from PATH
    export PATH=$(echo "$PATH" | sed -e "s|:$MSF_ROOT||g" -e "s|$MSF_ROOT:||g" -e "s|$MSF_ROOT||g")
    
    # Unset MSF environment variables
    unset MSF_ROOT
    unset MSF_DATABASE_CONFIG
    unset MSF_MODULE_PATHS
    unset MSF_PLUGIN_PATH
    unset MSF_DATA_ROOT
    
    # Remove aliases
    unalias msfconsole 2>/dev/null
    unalias msfvenom 2>/dev/null
    unalias msfd 2>/dev/null
    unalias msfrpc 2>/dev/null
    unalias msfrpcd 2>/dev/null
    unalias msfdb 2>/dev/null
    unalias msfpy 2>/dev/null
    unalias msf-python 2>/dev/null
    
    # Remove deactivate function itself
    unset -f deactivate-msf
    
    echo "Metasploit environment deactivated."
}

# Export the deactivation function
export -f deactivate-msf 2>/dev/null || true
