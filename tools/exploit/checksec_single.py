#!/usr/bin/env python3
"""
Lightweight wrapper around checksec for a single binary.
"""

import argparse
import shutil
import subprocess
import sys


def run_checksec(binary: str) -> int:
    if not shutil.which("checksec"):
        print("[-] checksec not found in PATH")
        return 1

    try:
        result = subprocess.run(
            ["checksec", "--file", binary],
            capture_output=True,
            text=True,
            timeout=30,
        )
        if result.stdout:
            print(result.stdout.strip())
        if result.returncode != 0 and result.stderr:
            print(result.stderr.strip(), file=sys.stderr)
        return result.returncode
    except subprocess.SubprocessError as exc:
        print(f"[-] checksec failed: {exc}", file=sys.stderr)
        return 1


def main() -> None:
    parser = argparse.ArgumentParser(description="Run checksec on a binary")
    parser.add_argument("binary", help="Path to binary")
    args = parser.parse_args()
    sys.exit(run_checksec(args.binary))


if __name__ == "__main__":
    main()
