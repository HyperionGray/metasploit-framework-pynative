#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Metasploit Framework Console - PyNative Version

This user interface provides users with a command console interface to the
framework. This is the Python-native implementation.

Converted from Ruby msfconsole script - Ruby will be deleted soon.
"""

import sys
import os
from pathlib import Path


def main():
    """Main entry point for msfconsole."""
    
    # Check if MSF environment is active
    msf_env_active = os.environ.get('MSF_PYTHON_MODE') == '1'
    
    if not msf_env_active and not os.environ.get('MSF_QUIET') and '-q' not in sys.argv and '--quiet' not in sys.argv:
        print("\n" + "="*70)
        print("  üêç Metasploit Framework - Enhanced Experience Available!")
        print("="*70)
        print("  You're running msfconsole directly, but we recommend our")
        print("  enhanced shell environment for the best MSF experience!")
        print("")
        print("  üöÄ RECOMMENDED: Activate MSF Environment")
        print("     source msfrc")
        print("     msf_console    # Enhanced Python console")
        print("     msf_info       # See all available commands")
        print("")
        print("  Benefits of 'source msfrc':")
        print("  ‚úÖ All MSF commands in your regular shell")
        print("  ‚úÖ Python-enhanced console experience")
        print("  ‚úÖ Environment variables auto-configured")
        print("  ‚úÖ Easy access to all MSF tools")
        print("")
        print("  Continuing with direct console...")
        print("="*70 + "\n")
    
    # Show PyNative message
    if not os.environ.get('MSF_QUIET') and '-q' not in sys.argv and '--quiet' not in sys.argv:
        if msf_env_active:
            print("üêç MSF Environment Active - Python Console")
        else:
            print("üêç PyNative Metasploit Framework Console")
            print("(Consider 'source msfrc' for enhanced experience)")
    
    # Get the repo root
    repo_root = Path(__file__).parent.resolve()
    
    # Delegate to Ruby version for now (until full Python implementation is ready)
    ruby_script = repo_root / "msfconsole.rb"
    if ruby_script.exists():
        try:
            os.execv(str(ruby_script), ['msfconsole'] + sys.argv[1:])
        except Exception as e:
            print(f"Error executing Ruby msfconsole: {e}", file=sys.stderr)
            if not msf_env_active:
                print("\nüí° TIP: For better MSF experience, try:")
                print("   source msfrc")
                print("   msf_console")
            sys.exit(1)
    else:
        print("Error: Ruby msfconsole not found", file=sys.stderr)
        print("Native Python console implementation pending Ruby removal", file=sys.stderr)
        if not msf_env_active:
            print("\nüí° TIP: For MSF environment setup, try:")
            print("   source msfrc")
            print("   msf_info")
        sys.exit(1)


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\nAborting...")
        sys.exit(1)
