# Simulated Malware Modules (Time-Bomb Style)

## Overview

This directory contains **Simulated Malware** modules designed for penetration testing and red team exercises. These modules demonstrate realistic malware behaviors while including automatic cleanup mechanisms to ensure responsible testing practices.

## Key Features

### Time-Bomb Mechanism

All modules in this category include a configurable time-bomb feature:
- **Automatic Cleanup**: Artifacts self-destruct after a specified time period
- **No Manual Intervention**: Reduces risk of leaving test artifacts on systems
- **Configurable Duration**: Typically 1-72 hours, adjustable per engagement

### Safe for Testing

Unlike actual malware, these modules are designed with safety in mind:
- **Simulated Payloads**: Default behaviors are benign and for demonstration only
- **Predictable Cleanup**: Known expiration times prevent long-term persistence
- **Documented Behavior**: Full transparency of what each module does
- **Audit Trail**: Logs and documentation for compliance

## Available Modules

### 1. Time-Bomb Persistence (`timebomb_persistence.rb`)

Simulates persistent backdoor behavior with automatic removal.

**Features:**
- Multi-platform support (Windows, Linux, macOS, Unix)
- Multiple trigger types (Boot, Login, Interval)
- Platform-appropriate persistence mechanisms
- Automatic cleanup of all persistence artifacts

**Use Cases:**
- Demonstrate persistence techniques
- Test detection capabilities
- Red team exercises
- Security awareness training

**Documentation:** [timebomb_persistence.md](../../../../documentation/modules/post/multi/malware/timebomb_persistence.md)

### 2. Time-Bomb File Dropper (`file_dropper_timebomb.rb`)

Simulates malware file dropping with automatic file removal.

**Features:**
- Upload any file to target system
- Optional immediate execution
- Automatic file deletion after expiration
- Cross-platform support

**Use Cases:**
- Simulate APT file staging
- Test file integrity monitoring
- Demonstrate file-based persistence
- EDR/AV testing

**Documentation:** [file_dropper_timebomb.md](../../../../documentation/modules/post/multi/malware/file_dropper_timebomb.md)

### 3. Time-Bomb Beacon (`beacon_timebomb.rb`)

Simulates C2 beacon behavior with automatic cleanup.

**Features:**
- Periodic "check-in" simulation (logging only, no network traffic)
- Configurable beacon intervals
- Automatic removal of beacon scripts and scheduled tasks
- Multi-platform support

**Use Cases:**
- Demonstrate C2 communication patterns
- Test scheduled task monitoring
- Simulate APT behavior
- Security operations training

## Usage Guidelines

### For Penetration Testers

1. **Authorization**: Always obtain written authorization before deployment
2. **Documentation**: Document all deployed modules and expiration times
3. **Verification**: Verify cleanup occurs as expected
4. **Coordination**: Inform security teams when deploying simulated malware
5. **Scope**: Only use on systems within the authorized scope

### Recommended Settings

- **Initial Testing**: 1-4 hours expiration
- **Short Engagements**: 12-24 hours expiration
- **Extended Red Teams**: 24-72 hours expiration
- **Never**: >72 hours in production environments

### Example Workflow

```bash
# 1. Establish session
msf6 > use exploit/multi/handler
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > run

# 2. Deploy simulated malware
msf6 > use post/multi/malware/timebomb_persistence
msf6 post(multi/malware/timebomb_persistence) > set SESSION 1
msf6 post(multi/malware/timebomb_persistence) > set EXPIRATION_HOURS 24
msf6 post(multi/malware/timebomb_persistence) > set TRIGGER BOOT
msf6 post(multi/malware/timebomb_persistence) > run

# 3. Document deployment
# Record: Module name, session ID, target system, expiration time

# 4. Monitor for detection
# Check if security tools detect and respond to the simulated malware

# 5. Verify cleanup
# After expiration, verify all artifacts are removed
```

## Detection Indicators

These modules create detectable artifacts that security tools should identify:

### File System

- Script files in temporary directories
- Hidden files on Unix systems
- PowerShell scripts on Windows

### Configuration Changes

- Registry Run keys (Windows)
- Scheduled Tasks (Windows)
- Cron jobs (Linux/Unix)
- Systemd services (Linux)
- LaunchAgents (macOS)

### Process Activity

- PowerShell execution with `-WindowStyle Hidden`
- Background script execution
- Scheduled task execution

### Logs and Events

- Windows Event Logs (Task Scheduler events)
- Syslog entries (cron execution)
- System service logs (systemd)

## Security Considerations

### Why Simulated Malware?

Real malware is:
- **Illegal** to deploy without authorization
- **Dangerous** if it spreads beyond intended targets
- **Difficult to clean up** completely
- **Unpredictable** in behavior

Simulated malware provides:
- **Legal** testing under authorized engagements
- **Contained** behavior within scope
- **Automatic cleanup** for responsible testing
- **Predictable** and documented behavior

### Limitations

These modules are **not** suitable for:
- Production systems without authorization
- Long-term persistence demonstrations (>72 hours)
- Systems where cleanup cannot be verified
- Environments with strict change control

### Responsible Use

- Only use in authorized testing scenarios
- Follow organizational policies and legal requirements
- Maintain detailed logs of all deployments
- Coordinate with security and IT teams
- Have backup cleanup procedures ready
- Test in lab environments first

## Testing Recommendations

### Pre-Deployment

1. Test in isolated lab environment
2. Verify cleanup mechanisms work correctly
3. Document exact behavior and artifacts
4. Prepare manual cleanup procedures as backup

### During Deployment

1. Document deployment time and expiration
2. Monitor for security tool detection
3. Take screenshots/logs of deployment
4. Keep session alive until cleanup verified (if possible)

### Post-Deployment

1. Verify cleanup occurred at expiration
2. Document any remaining artifacts
3. Include findings in penetration test report
4. Provide recommendations for detection improvements

## Technical Details

### Platform Detection

All modules automatically detect the target platform:
- Meterpreter sessions: Use `sysinfo`
- Shell sessions: Use `uname -s` or `ver`

### Persistence Mechanisms

Each module uses platform-appropriate techniques:

**Windows:**
- Registry Run keys (User-level)
- Scheduled Tasks (User or System-level)
- PowerShell with `-WindowStyle Hidden`

**Linux:**
- Systemd services (requires privileges)
- Cron jobs (user-level)
- Bash scripts with hidden names

**macOS:**
- LaunchAgents (user-level)
- LaunchDaemons (requires privileges)
- Bash scripts

**Unix:**
- Cron jobs (primary method)
- Init scripts (requires privileges)

### Cleanup Mechanisms

Cleanup is implemented through:
- Scheduled tasks that delete themselves
- Scripts that check expiration before execution
- Background processes that sleep until expiration
- Cron jobs that remove themselves after execution

## Contributing

When adding new simulated malware modules:

1. **Include Time-Bomb**: All modules must have automatic cleanup
2. **Document Thoroughly**: Provide detailed documentation
3. **Test Cleanup**: Verify cleanup works on all platforms
4. **Follow Conventions**: Use existing modules as templates
5. **Security Focus**: Emphasize safety and responsible use

## Support and Questions

For questions or issues:
- **GitHub Issues**: [metasploit-framework issues](https://github.com/rapid7/metasploit-framework/issues)
- **Documentation**: [Metasploit Docs](https://docs.metasploit.com/)
- **Community**: [Metasploit Slack](https://www.metasploit.com/slack)

## References

- [MITRE ATT&CK Framework](https://attack.mitre.org/)
- [Metasploit Module Development](https://docs.metasploit.com/docs/development/developing-modules/)
- [Penetration Testing Guidelines](https://www.sans.org/white-papers/)
- [Red Team Operations](https://www.amazon.com/Red-Team-Operations-Operations-Security/dp/1718503504)

## License

All modules in this directory are released under the Metasploit Framework License (BSD).

---

**Warning**: These modules should only be used in authorized testing scenarios. Unauthorized use may violate computer fraud and abuse laws.
